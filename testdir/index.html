<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>本格風オセロ（Reversi）</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#10b981;
    --muted:#9aa4b2;
    --card:#0f1728;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; padding:0;}
  body{
    margin:0;
    font-family: Inter, "Helvetica Neue", Hiragino Kaku Gothic ProN, "Noto Sans JP", sans-serif;
    background: linear-gradient(180deg,#051025 0%, #071127 60%);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
    gap:20px;
  }

  .app {
    width:100%;
    max-width:1100px;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:20px;
  }

  .board-wrap {
    background: linear-gradient(180deg,#07202a 0%, #05202a 60%);
    padding:18px;
    border-radius:14px;
    box-shadow: 0 8px 30px rgba(2,8,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .board {
    display:grid;
    grid-template-columns: repeat(8, minmax(0,1fr));
    gap:6px;
    aspect-ratio:1 / 1;
    width: 100%;
    max-width: 680px;
    border-radius:10px;
    padding:10px;
    background: linear-gradient(180deg,#092b24 0%, #06322a 100%);
    box-shadow: inset 0 2px 12px rgba(0,0,0,0.6);
  }

  .cell {
    position:relative;
    background: linear-gradient(180deg,#113a2d 0%, #0a2c22 100%);
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    user-select:none;
    transition: transform .06s ease;
  }
  .cell:active{transform:scale(.98)}
  .cell.disabled{cursor:default; opacity:.95}
  .disc {
    width:74%;
    height:74%;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 6px 14px rgba(0,0,0,0.45), inset 0 -6px 12px rgba(0,0,0,0.25);
    transition: transform .18s ease, box-shadow .18s ease;
    transform-origin:center;
  }
  .disc.black { background: radial-gradient(circle at 30% 30%, #0b0b0b, #1b1b1b); }
  .disc.white { background: radial-gradient(circle at 30% 30%, #fff, #dfe8ee); }

  .hint {
    position:absolute;
    right:6px;
    bottom:6px;
    background: rgba(255,255,255,0.06);
    color:var(--muted);
    font-size:12px;
    padding:4px 6px;
    border-radius:6px;
    pointer-events:none;
  }

  .cell.valid{
    outline: 2px dashed rgba(255,255,255,0.06);
    box-shadow: 0 6px 18px rgba(2,8,23,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
  }
  .cell .dot {
    position:absolute;
    width:12px;
    height:12px;
    border-radius:50%;
    background:rgba(255,255,255,0.82);
    opacity:.95;
    transform: translateY(-2px);
  }
  .controls {
    background: linear-gradient(180deg,#061224 0%, #071731 100%);
    padding:18px;
    border-radius:14px;
    min-height: 360px;
    display:flex;
    flex-direction:column;
    gap:12px;
    box-shadow: 0 8px 30px rgba(2,8,23,0.6);
  }
  .row{display:flex;gap:8px;align-items:center}
  .title {
    font-weight:700;
    font-size:18px;
    letter-spacing:.2px;
  }
  .status {
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
  }
  .turn {
    padding:8px 12px;
    border-radius:999px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:flex;
    gap:8px;
    align-items:center;
  }
  .chip {
    width:18px;height:18px;border-radius:50%;
    box-shadow: 0 3px 8px rgba(0,0,0,0.4), inset 0 -3px 8px rgba(0,0,0,0.2);
  }
  .chip.black{background:#0b0b0b}
  .chip.white{background:linear-gradient(#fff,#dfe8ee)}
  .score {
    font-weight:600;
    color:var(--muted);
    font-size:13px;
  }

  .btn {
    appearance:none;
    border:0;
    padding:10px 12px;
    border-radius:10px;
    cursor:pointer;
    background:var(--glass);
    color:var(--muted);
    font-weight:600;
    transition: all .12s ease;
  }
  .btn:hover{ transform: translateY(-3px) }
  .btn.primary{
    background: linear-gradient(90deg,var(--accent), #06a27b);
    color:#042017;
    box-shadow: 0 8px 18px rgba(16,185,129,0.14);
  }

  .settings { display:flex; flex-direction:column; gap:8px; }
  .setting-row { display:flex; gap:8px; align-items:center; justify-content:space-between; }
  select,input[type=range]{background:transparent;color:var(--muted);border-radius:8px;padding:6px 8px;border:1px solid rgba(255,255,255,0.04)}
  small.muted{color:var(--muted);font-size:12px}

  footer.meta{margin-top:6px;color:var(--muted);font-size:12px}
  .history {
    margin-top:8px;
    display:flex; gap:8px; flex-wrap:wrap;
  }
  .move-pill{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);font-size:13px;color:var(--muted);cursor:pointer}
  .move-pill:hover{background:rgba(255,255,255,0.04)}

  @media (max-width:980px){
    .app{grid-template-columns: 1fr}
    .controls{order:2}
  }
  @media (max-width:768px) {
    .board {
      width: 90vw;
      max-width: none;
    }
  }
</style>
</head>
<body>
  <div class="app" aria-live="polite">
    <div class="board-wrap" role="application" aria-label="オセロ盤">
      <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px">
        <div>
          <div class="title">本格風オセロ</div>
          <div class="muted" style="color:var(--muted);font-size:13px">静的ウェブアプリ — 保存してすぐ遊べます</div>
        </div>
        <div class="status">
          <div class="turn" id="turnIndicator" aria-live="polite">
            <div class="chip" id="turnChip"></div>
            <div id="turnText" style="font-weight:700">黒の番</div>
          </div>
        </div>
      </div>

      <div id="board" class="board" role="grid" aria-label="8x8 のオセロ盤"></div>

      <div style="display:flex;gap:10px;margin-top:12px;align-items:center;justify-content:space-between">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="score" id="scoreDisplay">黒: 2  白: 2</div>
          <div style="color:var(--muted);font-size:13px" id="flipCount">—</div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="undoBtn">取り消し（Undo）</button>
          <button class="btn" id="passBtn">パス</button>
          <button class="btn primary" id="resetBtn">リセット</button>
        </div>
      </div>
    </div>

    <aside class="controls" aria-label="コントロールパネル">
      <div>
        <div class="title">コントロール</div>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">対戦モード・AIの強さなどを設定できます</div>
      </div>

      <div class="settings">
        <div class="setting-row">
          <label for="mode">モード</label>
          <select id="mode" aria-label="プレイヤーモード">
            <option value="pvp">人対人</option>
            <option value="pve">人対AI</option>
            <option value="eve">AI対AI（観戦）</option>
          </select>
        </div>

        <div class="setting-row">
          <label for="aiDepth">AI 強さ</label>
          <input id="aiDepth" type="range" min="1" max="5" step="1" value="3" aria-label="AIの探索深さ">
        </div>
        <div class="setting-row">
          <label for="hintToggle">合法手の数字表示</label>
          <input type="checkbox" id="hintToggle" checked aria-label="合法手の表示">
        </div>

        <div style="display:flex;gap:8px;margin-top:6px">
          <button class="btn" id="stepAI">AI 一手（観戦時・試し）</button>
          <button class="btn" id="flipAnimToggle">裏返しアニメON/OFF</button>
        </div>

        <div style="margin-top:12px">
          <div style="font-weight:700">履歴</div>
          <div class="history" id="historyList" aria-live="polite"></div>
        </div>

        <div style="margin-top:10px;color:var(--muted);font-size:13px">
          操作: マウスでセルクリック、またはキーボード方向+Enterで置けます。  
          角を重視する評価、可変深度のAI（アルファベータ）を搭載しています。
        </div>

      </div>

      <footer class="meta">
        <div style="margin-top:10px">作成: ChatGPT — オフラインで動作する静的アプリ</div>
        <div style="margin-top:6px;color:var(--muted)">保存して配布してください（index.html）</div>
      </footer>
    </aside>
  </div>

<script>
/*
  本格風オセロ実装 (静的フロントエンド)
  - 盤面は 8x8
  - 黒: 1, 白: -1, 空: 0
  - 合法手判定、裏返し、パス、終了判定
  - Undo（履歴）
  - AI: ミニマックス + アルファベータ、評価関数 (石差 + 角重視 + 可動手数)
*/

const BOARD_SIZE = 8;
const EMPTY = 0;
const BLACK = 1;
const WHITE = -1;
const DIRS = [
  [-1,-1],[-1,0],[-1,1],
  [0,-1],       [0,1],
  [1,-1], [1,0], [1,1]
];

let board = [];
let turn = BLACK;
let history = []; // {board, turn, move: {r,c} or null}
let moveList = [];
let flipAnimation = true;

const boardEl = document.getElementById('board');
const turnText = document.getElementById('turnText');
const turnChip = document.getElementById('turnChip');
const scoreDisplay = document.getElementById('scoreDisplay');
const flipCountEl = document.getElementById('flipCount');
const undoBtn = document.getElementById('undoBtn');
const resetBtn = document.getElementById('resetBtn');
const passBtn = document.getElementById('passBtn');
const modeSel = document.getElementById('mode');
const aiDepthRange = document.getElementById('aiDepth');
const hintToggle = document.getElementById('hintToggle');
const historyList = document.getElementById('historyList');
const stepAI = document.getElementById('stepAI');
const flipAnimToggle = document.getElementById('flipAnimToggle');

function cloneBoard(b){
  return b.map(row=>row.slice());
}

function initBoard(){
  board = Array.from({length:BOARD_SIZE}, ()=>Array(BOARD_SIZE).fill(EMPTY));
  const mid = BOARD_SIZE/2;
  board[mid-1][mid-1] = WHITE;
  board[mid][mid] = WHITE;
  board[mid-1][mid] = BLACK;
  board[mid][mid-1] = BLACK;
  turn = BLACK;
  history = [];
  moveList = [];
  pushHistory(null);
  render();
}

function pushHistory(move){
  history.push({
    board: cloneBoard(board),
    turn,
    move
  });
  updateHistoryUI();
}

function updateHistoryUI(){
  historyList.innerHTML = '';
  for(let i=1;i<history.length;i++){
    const mv = history[i].move;
    const txt = mv ? `${i}. ${String.fromCharCode(65+mv.c)}${mv.r+1}` : `${i}. pass`;
    const pill = document.createElement('div');
    pill.className = 'move-pill';
    pill.textContent = txt;
    pill.onclick = () => {
      loadHistory(i);
    };
    historyList.appendChild(pill);
  }
}

function loadHistory(index){
  if(index < 0 || index >= history.length) return;
  const h = history[index];
  board = cloneBoard(h.board);
  turn = h.turn;
  history = history.slice(0,index+1);
  render();
  updateHistoryUI();
}

function render(){
  boardEl.innerHTML = '';
  let scoreB = 0;
  let scoreW = 0;
  let validMoves = getValidMoves(board, turn);
  for(let r=0;r<BOARD_SIZE;r++){
    for(let c=0;c<BOARD_SIZE;c++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.setAttribute('role','gridcell');
      cell.setAttribute('aria-rowindex',r+1);
      cell.setAttribute('aria-colindex',c+1);
      if(board[r][c] === BLACK){
        const disc = document.createElement('div');
        disc.className = 'disc black';
        cell.appendChild(disc);
        scoreB++;
      } else if(board[r][c] === WHITE){
        const disc = document.createElement('div');
        disc.className = 'disc white';
        cell.appendChild(disc);
        scoreW++;
      } else {
        // 合法手の数字表示
        if(hintToggle.checked){
          const moveIndex = validMoves.findIndex(m => m.r === r && m.c === c);
          if(moveIndex !== -1){
            const hint = document.createElement('div');
            hint.className = 'hint';
            hint.textContent = (moveIndex + 1).toString();
            cell.appendChild(hint);
            cell.classList.add('valid');
          }
        } else if(validMoves.some(m => m.r === r && m.c === c)){
          cell.classList.add('valid');
        }
      }
      cell.onclick = () => {
        if(canPut(r,c)){
          putDisc(r,c);
        }
      };
      boardEl.appendChild(cell);
    }
  }
  scoreDisplay.textContent = `黒: ${scoreB}  白: ${scoreW}`;
  turnText.textContent = turn === BLACK ? '黒の番' : '白の番';
  turnChip.className = 'chip ' + (turn === BLACK ? 'black' : 'white');
}

function canPut(r,c){
  if(board[r][c] !== EMPTY) return false;
  return isValidMove(board, turn, r, c).length > 0;
}

function getValidMoves(bd, player){
  const moves = [];
  for(let r=0;r<BOARD_SIZE;r++){
    for(let c=0;c<BOARD_SIZE;c++){
      if(bd[r][c] === EMPTY && isValidMove(bd, player, r, c).length > 0){
        moves.push({r,c});
      }
    }
  }
  return moves;
}

function isValidMove(bd, player, r, c){
  if(bd[r][c] !== EMPTY) return [];
  let flipped = [];
  for(const