<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ルーレットアプリ</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #f0f0f0;
  }
  canvas {
    margin-top: 20px;
    background: white;
    border-radius: 50%;
  }
  .controls {
    margin-top: 10px;
  }
  button {
    margin: 5px;
    padding: 8px 12px;
  }
</style>
</head>
<body>
<h1>ルーレットアプリ</h1>
<canvas id="roulette" width="500" height="500"></canvas>
<div class="controls">
  <input type="text" id="itemInput" placeholder="項目名">
  <button onclick="addItem()">追加</button>
  <button onclick="removeItem()">削除</button>
  <button onclick="startRoulette()">スタート</button>
</div>

<script>
let items = ["りんご", "バナナ", "みかん", "ぶどう"];
let colors = [];
let spinning = false;
let angle = 0;
let spinSpeed = 0;
const canvas = document.getElementById("roulette");
const ctx = canvas.getContext("2d");
const radius = canvas.width / 2;

// ランダムカラー生成
function randomColor() {
  return `hsl(${Math.random()*360}, 70%, 70%)`;
}

function drawRoulette() {
  const centerX = radius;
  const centerY = radius;
  const arc = 2 * Math.PI / items.length;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 項目描画
  for (let i = 0; i < items.length; i++) {
    const startAngle = angle + i * arc;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, startAngle, startAngle + arc);
    ctx.closePath();
    ctx.fillStyle = colors[i];
    ctx.fill();
    ctx.stroke();

    // テキスト描画（枠内に収める）
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(startAngle + arc / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "black";
    ctx.font = "16px sans-serif";
    ctx.fillText(items[i], radius - 10, 5); 
    ctx.restore();
  }

  // 針（上向き）
  ctx.beginPath();
  ctx.moveTo(centerX - 10, 10);
  ctx.lineTo(centerX + 10, 10);
  ctx.lineTo(centerX, 40);
  ctx.closePath();
  ctx.fillStyle = "red";
  ctx.fill();
}

function update() {
  if (spinning) {
    angle += spinSpeed;
    spinSpeed *= 0.98; 
    if (spinSpeed < 0.002) spinning = false;
  }
  drawRoulette();
  requestAnimationFrame(update);
}

function startRoulette() {
  if (!spinning) {
    spinSpeed = Math.random() * 0.3 + 0.3;
    spinning = true;
  }
}

function addItem() {
  const val = document.getElementById("itemInput").value.trim();
  if (val) {
    items.push(val);
    colors.push(randomColor());
    document.getElementById("itemInput").value = "";
  }
}

function removeItem() {
  const val = document.getElementById("itemInput").value.trim();
  if (val) {
    const idx = items.indexOf(val);
    if (idx >= 0) {
      items.splice(idx, 1);
      colors.splice(idx, 1);
    }
    document.getElementById("itemInput").value = "";
  }
}

// 初期色設定
for (let i = 0; i < items.length; i++) {
  colors.push(randomColor());
}

update();
</script>
</body>
</html>