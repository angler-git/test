<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ルーレット</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin: 0;
    background: #f0f0f0;
  }
  canvas {
    background: white;
    border-radius: 50%;
    margin-top: 20px;
  }
  #controls {
    margin-top: 20px;
  }
  #pointer {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 40px solid red; /* 上向きの針 */
    top: 20px;
  }
</style>
</head>
<body>
<h1>ルーレット</h1>
<div id="pointer"></div>
<canvas id="wheel" width="500" height="500"></canvas>

<div id="controls">
  <input type="text" id="newItem" placeholder="項目名">
  <button onclick="addItem()">追加</button>
  <button onclick="removeItem()">削除</button>
  <button onclick="spin()">スタート</button>
</div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
let items = ["りんご", "バナナ", "オレンジ", "ぶどう"];
let colors = [];
let startAngle = 0;
let spinTimeout = null;
let spinAngle = 0;
let spinAngleIncrement = 0;
let spinning = false;

// ランダム色生成
function randomColor() {
  return `hsl(${Math.random()*360}, 80%, 70%)`;
}

// 項目描画
function drawWheel() {
  const outsideRadius = 200;
  const insideRadius = 50;
  const textRadius = 150;
  const arc = Math.PI * 2 / items.length;
  
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  for (let i = 0; i < items.length; i++) {
    const angle = startAngle + i * arc;
    ctx.fillStyle = colors[i] || (colors[i] = randomColor());

    ctx.beginPath();
    ctx.moveTo(canvas.width/2, canvas.height/2);
    ctx.arc(canvas.width/2, canvas.height/2, outsideRadius, angle, angle + arc, false);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(angle + arc / 2);
    ctx.textAlign = "center";
    ctx.fillStyle = "black";
    ctx.font = "16px sans-serif";
    ctx.fillText(items[i], 0, -textRadius);
    ctx.restore();
  }
}

// 回転処理
function rotateWheel() {
  startAngle += spinAngleIncrement * Math.PI / 180;
  spinAngleIncrement *= 0.97; // 減速
  if (spinAngleIncrement <= 0.2) {
    spinning = false;
    return;
  }
  drawWheel();
  spinTimeout = requestAnimationFrame(rotateWheel);
}

function spin() {
  if (spinning) return;
  spinning = true;
  spinAngleIncrement = Math.random() * 10 + 10;
  rotateWheel();
}

function addItem() {
  const val = document.getElementById("newItem").value.trim();
  if (val) {
    items.push(val);
    colors.push(randomColor());
    drawWheel();
  }
}

function removeItem() {
  const val = document.getElementById("newItem").value.trim();
  if (val) {
    const idx = items.indexOf(val);
    if (idx >= 0) {
      items.splice(idx, 1);
      colors.splice(idx, 1);
      drawWheel();
    }
  }
}

drawWheel();
</script>
</body>
</html>